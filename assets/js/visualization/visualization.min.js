async function main(){const{categories:t,questions:a,answers:e}=await import("./data.js"),{limesurvey_answers:n}=await import("./limesurvey_data.js"),r=n.length>0;let s=1;const l=window.matchMedia("only screen and (max-width: 992px)");let i=0,c=a.map((t=>t.hasOwnProperty("categories")?d3.range(t.categories.length):[])),o=t.map((()=>[]));const d=475,g=765;let m=d+g,p=0,u=50,h=0,f=0,y=89;const x=40,b=g/a.length,_=d3.select("div#karobau_viz").append("svg").attr("width","100%").attr("viewBox",`0 0 ${d+g} 850`).attr("preserveAspectRatio","xMidYMin meet").attr("id","karobau_viz_svg"),v=_.append("g").classed("viz_root",!0),$=v.append((()=>function(t=0,a=0){const e=d3.create("svg:g").attr("transform",`translate(${t}, ${a})`).attr("id","category_selection");return e.append("text").classed("header",!0).text("Teilnehmerübersicht").attr("x",d/2).attr("y",20).attr("dominant-baseline","central").attr("text-anchor","middle"),e.node()}(0,p))),w=v.append((()=>function(t=0,a=0){const e=d3.create("svg:g").attr("transform",`translate(${t}, ${a})`).attr("id","question_sentiment");return e.append("text").attr("dominant-baseline","hanging").classed("question_label",!0),e.append("g").attr("transform",`translate(0, ${y})`).classed("bar_root",!0),e.append("g").attr("transform",`translate(600, ${y})`).classed("legend_root",!0),e.node()}(d,u))).attr("display","none"),A=v.append((()=>function(t=0,a=0){const e=d3.create("svg:g").attr("transform",`translate(${t}, ${a})`).attr("id","question_yesno");e.append("text").attr("dominant-baseline","hanging").classed("question_label",!0);return e.append("g").attr("transform",`translate(0, ${y})`).classed("bar_root",true).append("text").text("Zustimmung in Prozent").classed("axis_label",!0).attr("dominant-baseline","hanging").attr("text-anchor","middle"),e.node()}(d,u))).attr("display","none"),j=v.append((()=>function(t=0,e=0){const n=g,r=40,s=a.length,l=d3.scaleBand().domain(d3.range(s)).rangeRound([0,n]),c=d3.create("svg:g").attr("transform",`translate(${t}, ${e})`).attr("id","tabs"),o=c.selectAll("g").data(a.map((t=>t.label))).join("g").on("click",(function(t,a){a!==i&&(i=a,function(){const t=v.select("g#tabs");t.selectAll("rect.tab").attr("class",((t,a)=>a===i?"tab active":"tab inactive"))}(),M())})).classed("hover_shadow",!0);return o.append("rect").attr("x",((t,a)=>l(a))).attr("width",l.bandwidth()).attr("height",r).attr("class",((t,a)=>a===i?"tab active":"tab inactive")),o.append("g").attr("transform",((t,a)=>`translate(${l.bandwidth()/2+l(a)}, 0)`)).append("text").attr("x",0).attr("y",r/2).attr("dominant-baseline","middle").attr("text-anchor","middle").selectAll("tspan").data((t=>t.split("\n"))).join("tspan").text((t=>t)).attr("dy",((t,a,e)=>a>0?"1.2em":e.length>1?`-${.6*(e.length-1)}em`:null)).attr("x",0),c.node()}(d,0))),q=v.append((()=>function(t,a){const e=d3.create("svg:g").attr("transform",`translate(${t}, ${a})`).classed("hover_shadow",!0).on("click",(function(){z=!z,I(l)}));return e.append("rect").attr("width",b).attr("height",x).classed("category_toggle",!0),e.append("text").text("Teilnehmer").attr("x",b/2).attr("y",x/2).attr("dominant-baseline","central").attr("text-anchor","middle"),e.node()}(d,0))).attr("display","none");let z=!1;L(),M();const k=v.append((()=>function(t,a){const e=d3.create("svg:g").attr("transform",`translate(${t}, ${a})`).attr("id","tabs");if(!r)return e.node();const n=["Studienergebnisse","weiterführende Ergebnisse","alle Ergebnisse"];l.matches&&(t+=b);const i=e.selectAll("g").data(n).join("g").attr("transform",((t,a)=>`translate(${a*b}, 0)`)).on("click",(function(t,a){s=a+1,L(),M()})).classed("hover_shadow",!0);return i.append("rect").attr("width",b).attr("height",x).classed("category_toggle",!0),i.append("text").attr("x",b/2).attr("y",x/2).attr("dominant-baseline","middle").attr("text-anchor","middle").text((t=>t)),e.node()}(d,0)));function O(t){let r=[];1===s?r=e:2===s?r=n:3===s&&(r=e.concat(n));const l=a[t];let i=r.filter((t=>t.categories.every(((t,a)=>E(a,t))))).map((a=>a.questions[t])),c=d3.transpose(i),o=d3.range(l.values.length);return"sentiment"===l.type?c.map((t=>o.map((a=>t.filter((t=>t===a)).length)))).map((t=>({answers:l.negative.map(((a,e)=>({value:t[a],index:e,type:-1}))).concat(l.neutral.map(((a,e)=>({value:t[a],index:e,type:0})))).concat(l.positive.map(((a,e)=>({value:t[a],index:e,type:1})))),sum_negative:d3.sum(l.negative,(a=>t[a])),sum_neutral:d3.sum(l.neutral,(a=>t[a])),sum_positive:d3.sum(l.positive,(a=>t[a]))}))):c.map((t=>o.map((a=>t.filter((t=>t===a)).length))))}function R(a){let r=[];1===s?r=e:2===s?r=n:3===s&&(r=e.concat(n));let l=d3.range(t.length).filter((t=>t!==a)),i=r.filter((t=>l.every((a=>E(a,t.categories[a]))))).map((t=>t.categories[a]));return d3.range(t[a].values.length).map((t=>i.filter((a=>a===t)).length))}function B(t,a){let e=a.split("\n");const n=e.indexOf("");e=e.filter((t=>""!==t)),t.selectAll("tspan").data(e).join("tspan").text((t=>t)).attr("dy",((t,a)=>a===n?"2.4em":a>0?"1.2em":null)).attr("x",0).attr("font-weight",((t,a)=>a>=n&&n>-1?"bold":null))}function L(){const a=d3.scaleBand().domain(d3.range(t.length)).range([40,220*t.length+40]).padding(.15);h=a.range()[1]-a.step()*a.paddingOuter();const e=t.map(((t,a)=>d3.hierarchy({name:t.category,children:d3.zip(t.values,R(a)).map(((t,e)=>({name:t[0],value:t[1],category:a,subcategory:e}))).filter((t=>t.value>0)),category:a}).sum((t=>t.value)).sort(((t,a)=>a.value-t.value)))),n=d3.pack().size([a.bandwidth(),a.bandwidth()]).padding(5);e.forEach(n);const r=e.map((t=>t.children.length)),s=r.map(((t,a)=>{const e=d3.schemeCategory10[a];let n=d3.hsl(e);return n.l=.9,t>1?d3.scaleLinear().domain([0,t-1]).range([e,n]):d3.scaleLinear().domain([0,.01]).range([e,n])})),l=r.map(((t,a)=>{let e=d3.hsl(d3.schemeCategory10[a]);e.s=.2;let n=d3.hsl(d3.schemeCategory10[a]);return n.s=.2,n.l=.9,t>1?d3.scaleLinear().domain([0,t-1]).range([e,n]):d3.scaleLinear().domain([0,.01]).range([e,n])})),i=$.selectAll("g.bigcircle_origin").data(e).join("g").attr("transform",((t,e)=>`translate(0, ${a(e)})`)).classed("bigcircle_origin",!0);i.selectAll("text.category_label").data((t=>[t.data.name])).join("text").text((t=>t)).attr("x",20).attr("y","-0.4em").classed("category_label",!0),i.selectAll("circle.bigcircle").data((t=>[t])).join("circle").classed("bigcircle",!0).classed("hover_shadow",!0).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("r",(t=>t.r)).on("click",(function(t){o[t.data.category]=[],L(),M()})),i.selectAll("circle.smallcircle").data((t=>t.descendants().filter((t=>1===t.depth))),(t=>`${t.data.category}_${t.data.subcategory}`)).join((t=>t.append("circle").classed("smallcircle",!0).classed("hover_shadow",!0).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill",((t,a)=>E(t.data.category,t.data.subcategory)?s[t.data.category](a):l[t.data.category](a))).on("click",(function(t){let a=t.data.category,e=t.data.subcategory,n=o[a].indexOf(e);n>-1?o[a].splice(n,1):o[a].push(e),L(),M()})).call((t=>t.transition().attr("r",(t=>t.r))))),(t=>t.call((t=>t.transition().attr("r",(t=>t.r)).attr("cx",(t=>t.x)).attr("cy",(t=>t.y)).attr("fill",((t,a)=>E(t.data.category,t.data.subcategory)?s[t.data.category](a):l[t.data.category](a)))))),(t=>t.call((t=>t.transition().attr("r",0).remove())))),i.selectAll("g.legend").data((t=>t.descendants().filter((t=>1===t.depth))),(t=>`${t.data.category}_${t.data.subcategory}`)).join((function(t){const e=t.append("g").classed("legend",!0).attr("transform",((t,e,n)=>`translate(${a.bandwidth()+25}, ${a.bandwidth()/2-15*n.length+10+30*e})`));return e.append("rect").attr("width",10).attr("height",10).style("fill",((t,a)=>s[t.data.category](a))),e.append("text").text((t=>t.data.name)).attr("x",15).attr("y",5).attr("dominant-baseline","central").classed("category_active",(t=>E(t.data.category,t.data.subcategory))),e}),(function(t){return t.select("rect").style("fill",((t,a)=>s[t.data.category](a))),t.transition().attr("transform",((t,e,n)=>`translate(${a.bandwidth()+25}, ${a.bandwidth()/2-15*n.length+10+30*e})`)),t.select("text").classed("category_active",(t=>E(t.data.category,t.data.subcategory))),t}))}function M(){"sentiment"===a[i].type?(w.attr("display",null),A.attr("display","none"),function(){const t=40,e=300,n=40,r=250,s=a[i],l=O(i),o=d3.zip(s.subquestions,l),d=o.length,g=s.values.length,m="#5f9ed1",p="#a2c8ec",u="#cfcfcf",h="#ffbc79",x="#ff800e",b=d3.interpolateRgb(m,p),_=1===s.negative.length?[b(1/3)]:s.negative.map(((t,a,e)=>b(a/e.length))),v=d3.interpolateRgb(h,x),$=1===s.positive.length?[v(2/3)]:s.positive.map(((t,a,e)=>v(a/e.length))),A=_.concat(s.neutral.map((()=>u))).concat($),j=d3.max(l,(t=>t.sum_negative+t.sum_neutral/2)),q=d3.max(l,(t=>t.sum_positive+t.sum_neutral/2)),z=Math.max(j,q),k=d3.scaleLinear().domain([0,2*z]).rangeRound([0,e]),R=d3.scaleBand().domain(d3.range(g)).range([0,30*g]);B(w.select("text.question_label"),s.question);const L=w.select("g.bar_root");if(s.hasOwnProperty("categories")){const a=s.categories,l=a.map(((t,a)=>c[i].indexOf(a)>-1)),d=a.map((a=>d3.scaleBand().domain(d3.range(a.values.length)).rangeRound([0,t*a.values.length]).paddingInner(.08))),g=l.map(((t,a)=>t?d[a].range()[1]:0)),m=[].slice.call(d3.cumsum([0].concat(g.slice(0,-1).map((a=>a+t)))));f=d3.sum(g)+t*a.length+y,L.selectAll("g.bar_container.no_category").remove();const p=L.selectAll("g.question_category_container").data(a,(t=>`${i}_${t.name}`)).join((t=>t.append("g").classed("question_category_container",!0).attr("transform",((t,a)=>`translate(0, ${m[a]})`))),(t=>t.call((t=>t.transition().attr("transform",((t,a)=>`translate(0, ${m[a]})`)))))),u=p.selectAll("g.question_category_bar").data(((t,a)=>[[t,a]])).join("g").classed("hover_shadow",!0).on("click",(function(t){let a=c[i].indexOf(t[1]);a>-1?c[i].splice(a,1):c[i].push(t[1]),M()}));u.selectAll("rect").data((t=>[t[0]])).join("rect").classed("question_category",!0).attr("height",n).attr("width",e+r),u.selectAll("text").data((t=>[t[0].name])).join("text").text((t=>t)).attr("dominant-baseline","central").attr("y",n/2);const h=p.selectAll("g.bar_container").data(((t,a)=>l[a]?t.values.map((t=>[o[t],a])):[]),(t=>`${i}_${t[0]}`)).join((a=>a.append("g").attr("transform",`translate(0, ${t})`))).classed("bar_container",!0).call((a=>a.transition().attr("transform",((a,e)=>`translate(0, ${t+d[a[1]](e)})`))));h.selectAll("g.bar_origin").data((t=>[t[0][1]])).join("g").classed("bar_origin",!0).attr("transform",`translate(${r},0)`).selectAll("rect").data((function(t){let a=z-t.sum_negative-t.sum_neutral/2,e=d3.cumsum([a].concat(t.answers.map((t=>t.value)))).map(k),n=[].slice.call(e).map(((t,a,e)=>e[a+1]-t)).slice(0,-1);return d3.zip(e,n,A)})).join((t=>t.append("rect").attr("height",d[0].bandwidth()).attr("width",(t=>t[1])).attr("x",(t=>t[0])).style("fill",(t=>t[2]))),(t=>t.call((t=>t.transition().attr("width",(t=>t[1])).attr("x",(t=>t[0])))))),h.selectAll("text").data((t=>[t[0][0]])).join("text").attr("dominant-baseline","central").attr("y",20).selectAll("tspan").data((t=>t.split("\n"))).join("tspan").text((t=>t)).attr("dy",((t,a,e)=>a>0?"1.2em":e.length>1?`-${.6*(e.length-1)}em`:null)).attr("x",0)}else{const a=d3.scaleBand().domain(d3.range(d)).rangeRound([0,t*d]).paddingInner(.08);f=a.range()[1]-a.step()*a.paddingOuter()+y,L.selectAll("g.question_category_container").remove();const e=L.selectAll("g.bar_container").data(o,(t=>`${i}_${t[0]}`)).join("g").classed("bar_container",!0).classed("no_category",!0).attr("transform",((t,e)=>`translate(0, ${a(e)})`));e.selectAll("g.bar_origin").data((t=>[t[1]])).join("g").classed("bar_origin",!0).attr("transform",`translate(${r},0)`).selectAll("rect").data((function(t){let a=z-t.sum_negative-t.sum_neutral/2,e=d3.cumsum([a].concat(t.answers.map((t=>t.value)))).map(k),n=[].slice.call(e).map(((t,a,e)=>e[a+1]-t)).slice(0,-1);return d3.zip(e,n,A)})).join((t=>t.append("rect").attr("height",a.bandwidth()).attr("width",(t=>t[1])).attr("x",(t=>t[0])).style("fill",(t=>t[2]))),(t=>t.call((t=>t.transition().attr("width",(t=>t[1])).attr("x",(t=>t[0])))))),e.selectAll("text").data((t=>[t[0]])).join("text").attr("dominant-baseline","central").attr("y",a.bandwidth()/2).selectAll("tspan").data((t=>t.split("\n"))).join("tspan").text((t=>t)).attr("dy",((t,a,e)=>a>0?"1.2em":e.length>1?`-${.6*(e.length-1)}em`:null)).attr("x",0)}w.select("g.legend_root").selectAll("g.legend_origin").data(s.negative.concat(s.neutral).concat(s.positive).map((t=>s.values[t]))).join((function(t){const a=t.append("g").attr("transform",((t,a)=>`translate(0, ${R(a)})`)).classed("legend_origin",!0);return a.append("rect").attr("width",10).attr("height",10).style("fill",((t,a)=>A[a])),a.append("text").text((t=>t)).attr("x",15).attr("y","0.6em"),a}),(function(t){return t.select("rect").style("fill",((t,a)=>A[a])),t.select("text").text((t=>t)),t}))}()):(w.attr("display","none"),A.attr("display",null),function(){const t=40,e=300,n=a[i],r=O(i),s=d3.zip(n.subquestions,r),l=s.length,c=d3.max(r,(t=>t[0]+t[1])),o=d3.scaleLinear().domain([0,100*d3.max(r,(t=>t[1]))/c]).rangeRound([0,e]),d=d3.scaleBand().domain(d3.range(l)).rangeRound([0,t*l]).paddingInner(.08);f=d.range()[1]+30+y,B(A.select("text.question_label"),n.question);const g=A.select("g.bar_root"),m=g.selectAll("g.bar_container").data(s,(t=>`${i}_${t[0]}`)).join("g").classed("bar_container",!0).attr("transform",((t,a)=>`translate(0, ${d(a)})`));m.selectAll("rect.bar_yesno").data((t=>[100*t[1][1]/c])).join((t=>t.append("rect").attr("height",d.bandwidth()).attr("width",(t=>o(t))).attr("x",250).classed("bar_yesno",!0)),(t=>t.transition().attr("width",(t=>o(t))))),m.selectAll("text.bar_yesno_label").data((t=>{const a=100*t[1][1]/c;return[[a,o(a)>=30]]})).join((t=>t.append("text").attr("x",(t=>250+o(t[0])+(t[1]?-10:10))).attr("y",d.bandwidth()/2).classed("bar_yesno_label",!0).attr("dominant-baseline","central").attr("text-anchor",(t=>t[1]?"end":"start")).text((t=>Math.round(t[0])))),(t=>t.transition().attr("x",(t=>250+o(t[0])+(t[1]?-10:10))).attr("text-anchor",(t=>t[1]?"end":"start")).text((t=>Math.round(t[0]))))),m.selectAll("text.subquestion").data((t=>[t[0]])).join("text").attr("dominant-baseline","central").attr("y",d.bandwidth()/2).classed("subquestion",!0).selectAll("tspan").data((t=>t.split("\n"))).join("tspan").text((t=>t)).attr("dy",((t,a,e)=>a>0?"1.2em":e.length>1?`-${.6*(e.length-1)}em`:null)).attr("x",0),g.select("text.axis_label").attr("x",250+e/2).attr("y",d.range()[1])}()),C()}function E(t,a){return 0===o[t].length||o[t].indexOf(a)>-1}function C(){let t=Math.max(u+f,p+h);l.matches&&(t+=x),_.attr("viewBox",`0 0 ${m} ${t}`)}function I(t){const a=r?x:0;t.matches?(m=g,z?v.transition().attr("transform","translate(0, 0)"):v.transition().attr("transform",`translate(${-d}, 0)`),A.attr("transform",`translate(${d}, ${u+40})`),w.attr("transform",`translate(${d}, ${u+40})`),j.attr("transform",`translate(${d}, 40)`),k.attr("transform",`translate(${d+b}, 0)`),q.attr("display",null)):(m=d+g,v.attr("transform","translate(0, 0)"),A.attr("transform",`translate(${d}, ${u+a})`),w.attr("transform",`translate(${d}, ${u+a})`),j.attr("transform",`translate(${d}, ${a})`),k.attr("transform",`translate(${d}, 0)`),q.attr("display","none")),C()}r&&(A.attr("transform",`translate(${d}, ${u+40})`),w.attr("transform",`translate(${d}, ${u+40})`),j.attr("transform",`translate(${d}, 40)`)),I(l),l.addEventListener("change",I)}main();